BEGIN TRANSACTION;
CREATE TABLE IF NOT EXISTS "Tag" (
	"ID"	INTEGER NOT NULL UNIQUE,
	"Text"	TEXT NOT NULL CHECK(length("Text") > 0) UNIQUE COLLATE NOCASE,
	PRIMARY KEY("ID" AUTOINCREMENT)
);
CREATE TABLE IF NOT EXISTS "DocumentsTags" (
	"DocumentID"	INTEGER NOT NULL,
	"TagID"	INTEGER NOT NULL,
	FOREIGN KEY("TagID") REFERENCES "Tag"("ID") ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY("DocumentID") REFERENCES "Document"("ID") ON DELETE CASCADE ON UPDATE CASCADE,
	PRIMARY KEY("DocumentID","TagID")
);
CREATE TABLE IF NOT EXISTS "Document" (
	"ID"	INTEGER NOT NULL UNIQUE,
	"Title"	TEXT NOT NULL DEFAULT 'Document' CHECK(length("Title") > 0) COLLATE NOCASE,
	"Content"	TEXT NOT NULL DEFAULT '',
	"Parent"	INTEGER,
	FOREIGN KEY("Parent") REFERENCES "Category"("ID") ON DELETE CASCADE ON UPDATE CASCADE,
	UNIQUE("Parent","Title"),
	PRIMARY KEY("ID" AUTOINCREMENT)
);
CREATE TABLE IF NOT EXISTS "Category" (
	"ID"	INTEGER NOT NULL UNIQUE,
	"Title"	TEXT NOT NULL DEFAULT 'Category' CHECK(length("Title") > 0) COLLATE NOCASE,
	"Parent"	INTEGER DEFAULT NULL,
	FOREIGN KEY("Parent") REFERENCES "Category"("ID") ON DELETE CASCADE ON UPDATE CASCADE,
	UNIQUE("Parent","Title"),
	PRIMARY KEY("ID" AUTOINCREMENT)
);
CREATE TABLE IF NOT EXISTS "Section" (
	"ID"	INTEGER NOT NULL UNIQUE,
	"Title"	TEXT NOT NULL DEFAULT 'Title' CHECK(length("Title") > 0) COLLATE NOCASE,
	"Content"	TEXT NOT NULL DEFAULT '',
	PRIMARY KEY("ID" AUTOINCREMENT)
);
CREATE TABLE IF NOT EXISTS "Subsections" (
	"SectionID"	INTEGER NOT NULL DEFAULT 0,
	"SubsectionID"	INTEGER NOT NULL DEFAULT 0 UNIQUE,
	"OrderIndex"	INTEGER NOT NULL DEFAULT 0,
	"ID"	INTEGER NOT NULL UNIQUE,
	FOREIGN KEY("SubsectionID") REFERENCES "Section"("ID") ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY("SectionID") REFERENCES "Section"("ID") ON UPDATE CASCADE ON DELETE NO ACTION,
	UNIQUE("SectionID","OrderIndex"),
	PRIMARY KEY("ID" AUTOINCREMENT)
);
CREATE TABLE IF NOT EXISTS "DocumentsSections" (
	"DocumentID"	INTEGER NOT NULL DEFAULT 0,
	"SectionID"	INTEGER NOT NULL DEFAULT 0 UNIQUE,
	"OrderIndex"	INTEGER DEFAULT 0,
	"ID"	INTEGER NOT NULL UNIQUE,
	FOREIGN KEY("SectionID") REFERENCES "Section"("ID") ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY("DocumentID") REFERENCES "Document"("ID") ON UPDATE CASCADE ON DELETE NO ACTION,
	UNIQUE("DocumentID","OrderIndex"),
	PRIMARY KEY("ID" AUTOINCREMENT)
);
INSERT INTO "Document" VALUES (1,'TestDoc','',1);
INSERT INTO "Category" VALUES (1,'Test',NULL);
INSERT INTO "Section" VALUES (1,'Section 1','');
INSERT INTO "Section" VALUES (2,'Section 1-1','');
INSERT INTO "Section" VALUES (3,'Section 1-1-1','');
INSERT INTO "Section" VALUES (4,'Section 2','');
INSERT INTO "Section" VALUES (5,'Section 2-1','');
INSERT INTO "Section" VALUES (6,'Section 2-2','');
INSERT INTO "Section" VALUES (7,'Section 2-1-1','');
INSERT INTO "Section" VALUES (8,'Section 2-2-1','');
INSERT INTO "Section" VALUES (9,'Section 2-1-2','');
INSERT INTO "Section" VALUES (10,'Section 2-1-1-1','');
INSERT INTO "Section" VALUES (11,'Section 2-1-1-2','');
INSERT INTO "Subsections" VALUES (1,2,0,1);
INSERT INTO "Subsections" VALUES (2,3,0,2);
INSERT INTO "Subsections" VALUES (4,5,0,3);
INSERT INTO "Subsections" VALUES (4,6,1,4);
INSERT INTO "Subsections" VALUES (5,7,0,5);
INSERT INTO "Subsections" VALUES (5,9,1,6);
INSERT INTO "Subsections" VALUES (6,8,0,7);
INSERT INTO "Subsections" VALUES (7,10,0,8);
INSERT INTO "Subsections" VALUES (7,11,1,9);
INSERT INTO "DocumentsSections" VALUES (1,1,0,1);
INSERT INTO "DocumentsSections" VALUES (1,4,1,2);
COMMIT;
